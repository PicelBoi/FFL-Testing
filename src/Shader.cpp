#include <Shader.h>

#include <gpu/rio_RenderState.h>
#include <math/rio_Matrix.h>
#include <misc/rio_MemUtil.h>

// for isCommonColorMarked
#include <nn/ffl/FFLiColor.h>

#if RIO_IS_CAFE
#include <gx2/registers.h>
#include <gx2/utils.h>
#endif // RIO_IS_CAFE

namespace {

#if RIO_IS_CAFE

#define GX2_ATTRIB_FORMAT_SNORM_10_10_10_2 (GX2AttribFormat(GX2_ATTRIB_FLAG_SIGNED | GX2_ATTRIB_TYPE_10_10_10_2))
#define GX2_SHADER_ALIGNMENT GX2_SHADER_PROGRAM_ALIGNMENT

#define GX2_COMP_SEL_X001 GX2_SEL_MASK(GX2_SQ_SEL_X, GX2_SQ_SEL_0, GX2_SQ_SEL_0, GX2_SQ_SEL_1)
#define GX2_COMP_SEL_XY01 GX2_SEL_MASK(GX2_SQ_SEL_X, GX2_SQ_SEL_Y, GX2_SQ_SEL_0, GX2_SQ_SEL_1)
#define GX2_COMP_SEL_XYZ1 GX2_SEL_MASK(GX2_SQ_SEL_X, GX2_SQ_SEL_Y, GX2_SQ_SEL_Z, GX2_SQ_SEL_1)
#define GX2_COMP_SEL_XYZW GX2_SEL_MASK(GX2_SQ_SEL_X, GX2_SQ_SEL_Y, GX2_SQ_SEL_Z, GX2_SQ_SEL_W)

inline void GX2InitAttribStream(
    GX2AttribStream* p_attribute,
    u32 location,
    u32 buffer,
    u32 offset,
    GX2AttribFormat format
)
{
    static constexpr u32 sFormatMask[] = {
        GX2_COMP_SEL_X001, GX2_COMP_SEL_XY01,
        GX2_COMP_SEL_X001, GX2_COMP_SEL_X001,
        GX2_COMP_SEL_XY01, GX2_COMP_SEL_X001,
        GX2_COMP_SEL_X001, GX2_COMP_SEL_XY01,
        GX2_COMP_SEL_XY01, GX2_COMP_SEL_XYZ1,
        GX2_COMP_SEL_XYZW, GX2_COMP_SEL_XYZW,
        GX2_COMP_SEL_XY01, GX2_COMP_SEL_XY01,
        GX2_COMP_SEL_XYZW, GX2_COMP_SEL_XYZW,
        GX2_COMP_SEL_XYZ1, GX2_COMP_SEL_XYZ1,
        GX2_COMP_SEL_XYZW, GX2_COMP_SEL_XYZW
    };

    p_attribute->buffer     = buffer;
    p_attribute->offset     = offset;
    p_attribute->location   = location;
    p_attribute->format     = format;
    p_attribute->mask       = sFormatMask[format & 0xff];
    p_attribute->type       = GX2_ATTRIB_INDEX_PER_VERTEX;
    p_attribute->aluDivisor = 0;
    p_attribute->endianSwap = GX2_ENDIAN_SWAP_DEFAULT;
}

#endif // RIO_IS_CAFE


const rio::BaseVec4f& getColorUniform(const FFLColor& color)
{
    return reinterpret_cast<const rio::BaseVec4f&>(color.r);
}

void safeNormalizeVec3(rio::BaseVec3f* vec) {
    float magnitude = std::sqrt(vec->x * vec->x + vec->y * vec->y + vec->z * vec->z);
    if (magnitude != 0.0f) {
        vec->x /= magnitude;
        vec->y /= magnitude;
        vec->z /= magnitude;
    }

    vec->x = std::fmax(std::fmin(vec->x, 1.0f), -1.0f);
    vec->y = std::fmax(std::fmin(vec->y, 1.0f), -1.0f);
    vec->z = std::fmax(std::fmin(vec->z, 1.0f), -1.0f);

    if (vec->x == 1.0f || vec->x == -1.0f) {
        vec->y = 0.0f;
        vec->z = 0.0f;
    } else if (vec->y == 1.0f || vec->y == -1.0f) {
        vec->x = 0.0f;
        vec->z = 0.0f;
    } else if (vec->z == 1.0f || vec->z == -1.0f) {
        vec->x = 0.0f;
        vec->y = 0.0f;
    }
}

void gramSchmidtOrthonormalizeMtx34(rio::BaseMtx34f* mat)
{
    rio::BaseVec3f c0, c0Normalized, c1, c1Normalized, c1New, c2New;

    // Extract and normalize the first column
    c0.x = mat->m[0][0];
    c0.y = mat->m[1][0];
    c0.z = mat->m[2][0];
    c0Normalized = c0;
    safeNormalizeVec3(&c0Normalized);

    // Extract and normalize the second column
    c1.x = mat->m[0][1];
    c1.y = mat->m[1][1];
    c1.z = mat->m[2][1];
    c1Normalized = c1;
    safeNormalizeVec3(&c1Normalized);

    // Compute the third column as the cross product of the first two normalized columns
    c2New.x = c0Normalized.y * c1Normalized.z - c0Normalized.z * c1Normalized.y;
    c2New.y = c0Normalized.z * c1Normalized.x - c0Normalized.x * c1Normalized.z;
    c2New.z = c0Normalized.x * c1Normalized.y - c0Normalized.y * c1Normalized.x;

    // Compute the new second column as the cross product of the third column and the first normalized column
    c1New.x = c2New.y * c0Normalized.z - c2New.z * c0Normalized.y;
    c1New.y = c2New.z * c0Normalized.x - c2New.x * c0Normalized.z;
    c1New.z = c2New.x * c0Normalized.y - c2New.y * c0Normalized.x;

    // Update the matrix with the new orthonormal columns
    mat->m[0][0] = c0Normalized.x;
    mat->m[1][0] = c0Normalized.y;
    mat->m[2][0] = c0Normalized.z;

    mat->m[0][1] = c1New.x;
    mat->m[1][1] = c1New.y;
    mat->m[2][1] = c1New.z;

    mat->m[0][2] = c2New.x;
    mat->m[1][2] = c2New.y;
    mat->m[2][2] = c2New.z;
}

// NOTE: there isn't a concrete way to determine the gamma type
// I don't know how it's being set OR if the decomp provides a way to set it
//static bool sGammaType = FFLiUseOffScreenSrgbFetch() ? 0 : 1;//1 : 0;
const bool sGammaType = 1;

// MATERIALS SECTION!!!!!
// nn::mii::Material contains DrawParamMaterial

struct Color3 {
    float r;
    float g;
    float b;
};

struct SpecularMaterial {
    Color3 color;
    float factorA;
    float factorB;
    float shinness;
};

struct RimLightMaterial {
    Color3 color;
    float power;
    float width;
};

struct DrawParamMaterial {
    float halfLambertFactor;
    float sssSpecularBlendFactor;
    Color3 sssColor;
    SpecularMaterial specular;
    RimLightMaterial rimLight;
};

// material tables go in this order
enum MaterialType {
    MaterialType_Mask = 0,
    MaterialType_Glass,
    MaterialType_Pants,
    MaterialType_Faceline,
    MaterialType_Nose,
    MaterialType_Body,
    MaterialType_Hat,
    MaterialType_Hair,
    MaterialType_Beard,
    MaterialType_Max
};

const DrawParamMaterial cMaskMaterial =
    { 0.0f, 1.0f, { 0.0f, 0.0f, 0.0f }, { { 0.0f, 0.0f, 0.0f }, 0.0f, 0.0f, 0.1f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } } // line 4
;

const DrawParamMaterial cGlassMaterial =
    { 0.35f, 1.0f, { 0.0f, 0.0f, 0.0f }, { { 0.09804292f, 0.09804292f, 0.09804292f }, 0.3f, 0.0f, 30.0f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } } // line 8
;

const DrawParamMaterial cPantsMaterials[2] = {
    { 0.6f, 1.0f, { 0.0f, 0.0f, 0.0f }, { { 0.01960913f, 0.01960913f, 0.01960913f }, 1.0f, 0.02f, 0.7f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } }, // line 12
    { 0.6f, 1.0f, { 0.0f, 0.0f, 0.0f }, { { 0.01960913f, 0.01960913f, 0.01960913f }, 1.0f, 0.02f, 0.7f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } } // line 13
};

const DrawParamMaterial cFacelineMaterials[10] = {
    { 0.4f, 1.0f, { 0.6470634f, 0.1333377f, 0.0f }, { { 0.1764755f, 0.08235628f, 0.05882626f }, 2.6f, 0.02f, 0.8f }, { { 0.2627507f, 0.1176511f, 0.08627796f }, 2.0f, 0.3f } }, // line 17
    { 0.4f, 1.0f, { 0.6431419f, 0.03529608f, 0.0f }, { { 0.1372593f, 0.09412124f, 0.03921773f }, 2.6f, 0.02f, 0.8f }, { { 0.2352996f, 0.1568674f, 0.06666958f }, 2.0f, 0.3f } },
    { 0.4f, 1.0f, { 0.2941234f, 0.0f, 0.0f }, { { 0.1215728f, 0.03921773f, 0.01176563f }, 2.6f, 0.02f, 0.8f }, { { 0.2431428f, 0.07843459f, 0.0235309f }, 2.0f, 0.3f } },
    { 0.4f, 1.0f, { 0.6980433f, 0.03921773f, 0.0f }, { { 0.1137294f, 0.05490454f, 0.01960913f }, 2.6f, 0.02f, 0.8f }, { { 0.2352996f, 0.1176511f, 0.03921773f }, 2.0f, 0.3f } },
    { 0.4f, 1.0f, { 0.2000051f, 0.01176563f, 0.0f }, { { 0.1254943f, 0.02745257f, 0.01176563f }, 2.6f, 0.02f, 0.8f }, { { 0.250986f, 0.05490454f, 0.0235309f }, 2.0f, 0.3f } },
    { 0.4f, 1.0f, { 0.05882626f, 0.00392195f, 0.0f }, { { 0.03137433f, 0.00784381f, 0.00392195f }, 2.6f, 0.02f, 0.8f }, { { 0.250986f, 0.06274787f, 0.03137433f }, 2.0f, 0.3f } },
    { 0.4f, 1.0f, { 0.6549063f, 0.1568674f, 0.0f }, { { 0.1764755f, 0.08235628f, 0.05882626f }, 2.6f, 0.02f, 0.8f }, { { 0.2627507f, 0.1215728f, 0.08627796f }, 2.0f, 0.3f } },
    { 0.4f, 1.0f, { 0.5882402f, 0.1098079f, 0.03529608f }, { { 0.1372593f, 0.07843459f, 0.03921773f }, 2.6f, 0.02f, 0.8f }, { { 0.2352996f, 0.1451026f, 0.08235628f }, 2.0f, 0.3f } },
    { 0.4f, 1.0f, { 0.07843459f, 0.00392195f, 0.00392195f }, { { 0.05882626f, 0.01960913f, 0.00392195f }, 2.6f, 0.02f, 0.8f }, { { 0.2352996f, 0.04706119f, 0.01176563f }, 2.0f, 0.3f } },
    { 0.4f, 1.0f, { 0.01960913f, 0.0f, 0.0f }, { { 0.01960913f, 0.00784381f, 0.00392195f }, 2.6f, 0.02f, 0.8f }, { { 0.2352996f, 0.07843459f, 0.03921773f }, 2.0f, 0.3f } } // line 26
};

const DrawParamMaterial cNoseMaterials[10] = {
    { 0.3f, 0.0f, { 0.6470634f, 0.1333377f, 0.0f }, { { 0.1764755f, 0.08235628f, 0.05882626f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.6431419f, 0.03529608f, 0.0f }, { { 0.1372593f, 0.09412124f, 0.03921773f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.2941234f, 0.0f, 0.0f }, { { 0.1215728f, 0.03921773f, 0.01176563f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.6980433f, 0.03921773f, 0.0f }, { { 0.1137294f, 0.05490454f, 0.01960913f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.2000051f, 0.01176563f, 0.0f }, { { 0.1254943f, 0.02745257f, 0.01176563f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.05882626f, 0.00392195f, 0.0f }, { { 0.03137433f, 0.00784381f, 0.00392195f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.6549063f, 0.1568674f, 0.0f }, { { 0.1764755f, 0.08235628f, 0.05882626f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.5882402f, 0.1098079f, 0.03529608f }, { { 0.1372593f, 0.07843459f, 0.03921773f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.07843459f, 0.00392195f, 0.00392195f }, { { 0.05882626f, 0.01960913f, 0.00392195f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } },
    { 0.3f, 0.0f, { 0.01960913f, 0.0f, 0.0f }, { { 0.01960913f, 0.00784381f, 0.00392195f }, 2.6f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 0.55f, 0.0f } } // line 39
};

const DrawParamMaterial cBodyMaterials[12] = {
    { 0.5f, 0.0f, { 0.1647106f, 0.01176563f, 0.00392195f }, { { 0.1647106f, 0.0235309f, 0.01568734f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } }, // line 43
    { 0.5f, 0.0f, { 0.2745156f, 0.0f, 0.0f }, { { 0.2000051f, 0.08627796f, 0.01960913f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.2000051f, 0.08235628f, 0.00392195f }, { { 0.2000051f, 0.1686323f, 0.0235309f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.0235309f, 0.08235628f, 0.0235309f }, { { 0.09412124f, 0.1647106f, 0.0235309f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.0f, 0.04706119f, 0.03529608f }, { { 0.0f, 0.09412124f, 0.03529608f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.0f, 0.02745257f, 0.1411809f }, { { 0.00784381f, 0.05490454f, 0.1411809f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.01176563f, 0.06666958f, 0.1725539f }, { { 0.04706119f, 0.1725539f, 0.2156916f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.04706119f, 0.03529608f, 0.09804292f }, { { 0.1921619f, 0.07059128f, 0.09804292f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.01960913f, 0.01568734f, 0.1333377f }, { { 0.09019956f, 0.03137433f, 0.1333377f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.0f, 0.0f, 0.01568734f }, { { 0.03137433f, 0.01176563f, 0.00392195f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } }, // line 52
    { 0.5f, 0.0f, { 0.04313947f, 0.08627796f, 0.1725539f }, { { 0.2196132f, 0.1725539f, 0.1725539f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } },
    { 0.5f, 0.0f, { 0.0f, 0.0f, 0.0f }, { { 0.01960913f, 0.01960913f, 0.01960913f }, 1.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.0f } } // line 14
};

const DrawParamMaterial cHatMaterials[12] = {
    { 0.6f, 1.0f, { 0.3333392f, 0.0f, 0.00392195f }, { { 0.2470644f, 0.0f, 0.00784381f }, 2.0f, 0.0f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } }, // line 56
    { 0.6f, 1.0f, { 0.5098094f, 0.2745156f, 0.03921773f }, { { 0.2156916f, 0.1451026f, 0.02745257f }, 2.0f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.6f, 1.0f, { 0.3921627f, 0.1372593f, 0.03921773f }, { { 0.2352996f, 0.1176511f, 0.03921773f }, 1.1f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.6f, 1.0f, { 0.1176511f, 0.3137313f, 0.03921773f }, { { 0.1098079f, 0.2470644f, 0.01960913f }, 2.0f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.6f, 1.0f, { 0.03921773f, 0.1176511f, 0.05098281f }, { { 0.01960913f, 0.1176511f, 0.01960913f }, 2.0f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.6f, 1.0f, { 0.01960913f, 0.05882626f, 0.1960836f }, { { 0.00392195f, 0.02745257f, 0.2627507f }, 2.0f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.6f, 1.0f, { 0.07843459f, 0.2235348f, 0.345104f }, { { 0.06274787f, 0.1647106f, 0.2392212f }, 2.0f, 0.8f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.6f, 1.0f, { 0.3137313f, 0.05882626f, 0.07843459f }, { { 0.2745156f, 0.05882626f, 0.07843459f }, 2.0f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.6f, 1.0f, { 0.1176511f, 0.02745257f, 0.3411824f }, { { 0.08627796f, 0.01176563f, 0.1725539f }, 2.0f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.6f, 1.0f, { 0.03921773f, 0.01960913f, 0.00784381f }, { { 0.03921773f, 0.01960913f, 0.00784381f }, 2.0f, 0.02f, 2.0f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } }, // line 65
    { 0.6f, 1.0f, { 0.4862802f, 0.4862802f, 0.3921627f }, { { 0.1568674f, 0.1568674f, 0.1176511f }, 2.0f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } }, // line 28
    { 0.6f, 1.0f, { 0.0f, 0.0f, 0.0f }, { { 0.00784381f, 0.00784381f, 0.00784381f }, 2.0f, 0.02f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } } // line 29
};

const DrawParamMaterial cHairMaterials[100] = {
    { 0.45f, 1.0f, { 0.00784381f, 0.00392195f, 0.00392195f }, { { 0.01960913f, 0.01568734f, 0.01568734f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } }, // line 69
    { 0.45f, 1.0f, { 0.01176563f, 0.00392195f, 0.0f }, { { 0.1254943f, 0.04706119f, 0.00784381f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01568734f, 0.00392195f, 0.0f }, { { 0.1803971f, 0.03529608f, 0.00392195f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.00784381f, 0.00392195f }, { { 0.2431428f, 0.09019956f, 0.01176563f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.0235309f, 0.02745257f }, { { 0.1411809f, 0.1411809f, 0.1490242f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01176563f, 0.01176563f, 0.0f }, { { 0.1529458f, 0.09412124f, 0.00784381f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.01568734f, 0.00392195f }, { { 0.2666723f, 0.1372593f, 0.01176563f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.03137433f, 0.01176563f }, { { 0.407849f, 0.250986f, 0.04313947f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0f, 0.0f, 0.0f }, { { 0.01176563f, 0.01176563f, 0.01176563f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01960913f, 0.01960913f, 0.01960913f }, { { 0.1254943f, 0.1333377f, 0.1333377f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01960913f, 0.01176563f, 0.00784381f }, { { 0.2000051f, 0.09412124f, 0.0235309f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01568734f, 0.01568734f, 0.00784381f }, { { 0.1882403f, 0.1451026f, 0.02745257f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01176563f, 0.01568734f, 0.03137433f }, { { 0.08235628f, 0.129416f, 0.3294176f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00784381f, 0.01960913f, 0.01568734f }, { { 0.06274787f, 0.1725539f, 0.1725539f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01568734f, 0.00784381f, 0.0f }, { { 0.1882403f, 0.08627796f, 0.00784381f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03137433f, 0.0f, 0.0f }, { { 0.3294176f, 0.0235309f, 0.00392195f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00392195f, 0.00784381f, 0.01960913f }, { { 0.03529608f, 0.07451299f, 0.2039268f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03137433f, 0.01568734f, 0.0f }, { { 0.3294176f, 0.1490242f, 0.0f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.01960913f, 0.01960913f }, { { 0.1411809f, 0.1333377f, 0.1215728f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.01568734f, 0.0f }, { { 0.4235353f, 0.1254943f, 0.00392195f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0f, 0.0f, 0.0f }, { { 0.01960913f, 0.01960913f, 0.01960913f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.01176563f, 0.01176563f }, { { 0.4784371f, 0.1098079f, 0.03921773f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.02745257f, 0.01960913f }, { { 0.4705939f, 0.2392212f, 0.06666958f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.02745257f, 0.01568734f, 0.01176563f }, { { 0.2745156f, 0.1254943f, 0.03529608f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.00392195f, 0.00392195f }, { { 0.2588292f, 0.05882626f, 0.01960913f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.01960913f, 0.01960913f }, { { 0.4980448f, 0.1803971f, 0.05882626f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.03137433f, 0.03137433f }, { { 0.4980448f, 0.2392212f, 0.09412124f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.03529608f, 0.03529608f }, { { 0.4980448f, 0.298045f, 0.1058862f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01960913f, 0.00784381f, 0.00784381f }, { { 0.2235348f, 0.07059128f, 0.03137433f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.02745257f, 0.00392195f, 0.01176563f }, { { 0.298045f, 0.04706119f, 0.03529608f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.00392195f, 0.01176563f }, { { 0.2705939f, 0.03529608f, 0.03529608f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03529608f, 0.01176563f, 0.01176563f }, { { 0.352947f, 0.09412124f, 0.03529608f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03529608f, 0.00392195f, 0.01568734f }, { { 0.3882412f, 0.04706119f, 0.04706119f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03137433f, 0.01568734f, 0.0235309f }, { { 0.345104f, 0.129416f, 0.07451299f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03529608f, 0.01568734f, 0.01960913f }, { { 0.3882412f, 0.129416f, 0.06274787f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.01960913f, 0.02745257f }, { { 0.4902016f, 0.1803971f, 0.08627796f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.03137433f, 0.03921773f }, { { 0.4941232f, 0.2666723f, 0.1176511f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.03921773f, 0.03921773f }, { { 0.4980448f, 0.3137313f, 0.1254943f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00784381f, 0.00392195f, 0.01176563f }, { { 0.09412124f, 0.04313947f, 0.03529608f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00784381f, 0.00784381f, 0.01176563f }, { { 0.06274787f, 0.06274787f, 0.1176511f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01176563f, 0.00392195f, 0.01176563f }, { { 0.1490242f, 0.03529608f, 0.04313947f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01960913f, 0.01176563f, 0.03137433f }, { { 0.2156916f, 0.1019645f, 0.1019645f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.01568734f, 0.03529608f }, { { 0.2588292f, 0.1411809f, 0.1058862f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03529608f, 0.0235309f, 0.03921773f }, { { 0.3764764f, 0.2039268f, 0.1176511f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03137433f, 0.02745257f, 0.03921773f }, { { 0.1960836f, 0.2274563f, 0.3921627f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03529608f, 0.03137433f, 0.04313947f }, { { 0.231378f, 0.2666723f, 0.4509861f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04313947f, 0.03529608f, 0.04706119f }, { { 0.278437f, 0.298045f, 0.4902016f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.03529608f, 0.04313947f }, { { 0.2470644f, 0.3058882f, 0.4627508f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00392195f, 0.00392195f, 0.01176563f }, { { 0.02745257f, 0.04706119f, 0.1254943f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0f, 0.01176563f, 0.01960913f }, { { 0.01960913f, 0.09804292f, 0.2000051f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00784381f, 0.0235309f, 0.03921773f }, { { 0.04706119f, 0.2039268f, 0.4156921f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01568734f, 0.03529608f, 0.04706119f }, { { 0.1019645f, 0.2823587f, 0.4745156f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.03529608f, 0.04313947f }, { { 0.1411809f, 0.3058882f, 0.4353f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.03137433f, 0.04706119f }, { { 0.1607891f, 0.2588292f, 0.4902016f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.03529608f, 0.04706119f }, { { 0.1529458f, 0.2941234f, 0.4902016f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03137433f, 0.04313947f, 0.04706119f }, { { 0.1882403f, 0.352947f, 0.4980448f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0f, 0.00784381f, 0.00784381f }, { { 0.01176563f, 0.07059128f, 0.1058862f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0f, 0.01176563f, 0.00784381f }, { { 0.0f, 0.09412124f, 0.1137294f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0f, 0.01176563f, 0.01568734f }, { { 0.01176563f, 0.1215728f, 0.1725539f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00392195f, 0.01960913f, 0.01568734f }, { { 0.03921773f, 0.1568674f, 0.1921619f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00784381f, 0.0235309f, 0.02745257f }, { { 0.05490454f, 0.1960836f, 0.2745156f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01176563f, 0.03137433f, 0.03137433f }, { { 0.09019956f, 0.2705939f, 0.345104f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.03529608f, 0.02745257f }, { { 0.1411809f, 0.3058882f, 0.3098098f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.03921773f, 0.03529608f }, { { 0.1490242f, 0.3294176f, 0.3764764f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.04313947f, 0.03529608f }, { { 0.1568674f, 0.3568686f, 0.3568686f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0f, 0.01176563f, 0.00784381f }, { { 0.01960913f, 0.1137294f, 0.02745257f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01176563f, 0.0235309f, 0.0f }, { { 0.129416f, 0.1882403f, 0.0f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0f, 0.01960913f, 0.01568734f }, { { 0.00392195f, 0.1803971f, 0.05490454f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.00784381f, 0.02745257f, 0.01960913f }, { { 0.1058862f, 0.2392212f, 0.06274787f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01176563f, 0.03137433f, 0.00392195f }, { { 0.1451026f, 0.2705939f, 0.01176563f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.02745257f, 0.03529608f, 0.0f }, { { 0.2862803f, 0.298045f, 0.00392195f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01568734f, 0.03529608f, 0.0235309f }, { { 0.1921619f, 0.3098098f, 0.07843459f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.02745257f, 0.04313947f, 0.01176563f }, { { 0.3098098f, 0.3490255f, 0.03529608f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.02745257f, 0.04313947f, 0.0235309f }, { { 0.2941234f, 0.345104f, 0.07059128f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03529608f, 0.04706119f, 0.03137433f }, { { 0.3647118f, 0.3764764f, 0.09804292f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.02745257f, 0.02745257f, 0.00784381f }, { { 0.298045f, 0.2274563f, 0.0235309f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03137433f, 0.02745257f, 0.01568734f }, { { 0.3254961f, 0.231378f, 0.05490454f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.03529608f, 0.00784381f }, { { 0.4000058f, 0.298045f, 0.03137433f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.03529608f, 0.0235309f }, { { 0.4000058f, 0.2902018f, 0.07843459f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.03921773f, 0.0235309f }, { { 0.4235353f, 0.3176529f, 0.07451299f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.03921773f, 0.01960913f }, { { 0.4156921f, 0.3372608f, 0.06274787f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.04313947f, 0.0235309f }, { { 0.4156921f, 0.3607903f, 0.07451299f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.04706119f, 0.02745257f }, { { 0.4235353f, 0.3921627f, 0.09019956f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.01176563f, 0.0f }, { { 0.2431428f, 0.1058862f, 0.0f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04313947f, 0.03529608f, 0.0235309f }, { { 0.4509861f, 0.2902018f, 0.07059128f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.04313947f, 0.01176563f }, { { 0.4980448f, 0.352947f, 0.04313947f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.04313947f, 0.0235309f }, { { 0.4902016f, 0.345104f, 0.07451299f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.04313947f, 0.02745257f }, { { 0.4823586f, 0.3647118f, 0.09019956f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.04706119f, 0.02745257f }, { { 0.4902016f, 0.3882412f, 0.09019956f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03137433f, 0.01176563f, 0.00392195f }, { { 0.3254961f, 0.1176511f, 0.01568734f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.02745257f, 0.0f }, { { 0.4980448f, 0.2352996f, 0.00392195f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03921773f, 0.02745257f, 0.01960913f }, { { 0.407849f, 0.2431428f, 0.05882626f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.03137433f, 0.01960913f }, { { 0.4980448f, 0.278437f, 0.05882626f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04706119f, 0.03529608f, 0.02745257f }, { { 0.4980448f, 0.3019665f, 0.08235628f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04313947f, 0.03921773f, 0.03137433f }, { { 0.4470646f, 0.3215744f, 0.1019645f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.01176563f, 0.01176563f, 0.01176563f }, { { 0.07843459f, 0.07843459f, 0.07843459f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.02745257f, 0.02745257f, 0.02745257f }, { { 0.1843188f, 0.1843188f, 0.1843188f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.03529608f, 0.03529608f, 0.03529608f }, { { 0.2235348f, 0.2235348f, 0.2235348f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.04313947f, 0.03921773f, 0.03921773f }, { { 0.2588292f, 0.250986f, 0.2431428f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.45f, 1.0f, { 0.0235309f, 0.0235309f, 0.0235309f }, { { 0.00392195f, 0.00392195f, 0.00392195f }, 1.0f, 0.06f, 0.8f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } } // line 168
};

const DrawParamMaterial cBeardMaterials[100] = {
    { 0.2f, 0.0f, { 0.00784381f, 0.00392195f, 0.00392195f }, { { 0.01960913f, 0.01568734f, 0.01568734f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } }, // line 172
    { 0.2f, 0.0f, { 0.01176563f, 0.00392195f, 0.0f }, { { 0.1254943f, 0.04706119f, 0.00784381f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01568734f, 0.00392195f, 0.0f }, { { 0.1803971f, 0.03529608f, 0.00392195f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.00784381f, 0.00392195f }, { { 0.2431428f, 0.09019956f, 0.01176563f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.0235309f, 0.02745257f }, { { 0.1411809f, 0.1411809f, 0.1490242f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01176563f, 0.01176563f, 0.0f }, { { 0.1529458f, 0.09412124f, 0.00784381f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.01568734f, 0.00392195f }, { { 0.2666723f, 0.1372593f, 0.01176563f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.03137433f, 0.01176563f }, { { 0.407849f, 0.250986f, 0.04313947f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0f, 0.0f, 0.0f }, { { 0.01176563f, 0.01176563f, 0.01176563f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01960913f, 0.01960913f, 0.01960913f }, { { 0.1254943f, 0.1333377f, 0.1333377f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01960913f, 0.01176563f, 0.00784381f }, { { 0.2000051f, 0.09412124f, 0.0235309f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01568734f, 0.01568734f, 0.00784381f }, { { 0.1882403f, 0.1451026f, 0.02745257f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01176563f, 0.01568734f, 0.03137433f }, { { 0.08235628f, 0.129416f, 0.3294176f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00784381f, 0.01960913f, 0.01568734f }, { { 0.06274787f, 0.1725539f, 0.1725539f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01568734f, 0.00784381f, 0.0f }, { { 0.1882403f, 0.08627796f, 0.00784381f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03137433f, 0.0f, 0.0f }, { { 0.3294176f, 0.0235309f, 0.00392195f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00392195f, 0.00784381f, 0.01960913f }, { { 0.03529608f, 0.07451299f, 0.2039268f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03137433f, 0.01568734f, 0.0f }, { { 0.3294176f, 0.1490242f, 0.0f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.01960913f, 0.01960913f }, { { 0.1411809f, 0.1333377f, 0.1215728f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.01568734f, 0.0f }, { { 0.4235353f, 0.1254943f, 0.00392195f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0f, 0.0f, 0.0f }, { { 0.01960913f, 0.01960913f, 0.01960913f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.01176563f, 0.01176563f }, { { 0.4784371f, 0.1098079f, 0.03921773f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.02745257f, 0.01960913f }, { { 0.4705939f, 0.2392212f, 0.06666958f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.02745257f, 0.01568734f, 0.01176563f }, { { 0.2745156f, 0.1254943f, 0.03529608f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.00392195f, 0.00392195f }, { { 0.2588292f, 0.05882626f, 0.01960913f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.01960913f, 0.01960913f }, { { 0.4980448f, 0.1803971f, 0.05882626f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.03137433f, 0.03137433f }, { { 0.4980448f, 0.2392212f, 0.09412124f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.03529608f, 0.03529608f }, { { 0.4980448f, 0.298045f, 0.1058862f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01960913f, 0.00784381f, 0.00784381f }, { { 0.2235348f, 0.07059128f, 0.03137433f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.02745257f, 0.00392195f, 0.01176563f }, { { 0.298045f, 0.04706119f, 0.03529608f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.00392195f, 0.01176563f }, { { 0.2705939f, 0.03529608f, 0.03529608f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03529608f, 0.01176563f, 0.01176563f }, { { 0.352947f, 0.09412124f, 0.03529608f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03529608f, 0.00392195f, 0.01568734f }, { { 0.3882412f, 0.04706119f, 0.04706119f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03137433f, 0.01568734f, 0.0235309f }, { { 0.345104f, 0.129416f, 0.07451299f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03529608f, 0.01568734f, 0.01960913f }, { { 0.3882412f, 0.129416f, 0.06274787f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.01960913f, 0.02745257f }, { { 0.4902016f, 0.1803971f, 0.08627796f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.03137433f, 0.03921773f }, { { 0.4941232f, 0.2666723f, 0.1176511f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.03921773f, 0.03921773f }, { { 0.4980448f, 0.3137313f, 0.1254943f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00784381f, 0.00392195f, 0.01176563f }, { { 0.09412124f, 0.04313947f, 0.03529608f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00784381f, 0.00784381f, 0.01176563f }, { { 0.06274787f, 0.06274787f, 0.1176511f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01176563f, 0.00392195f, 0.01176563f }, { { 0.1490242f, 0.03529608f, 0.04313947f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01960913f, 0.01176563f, 0.03137433f }, { { 0.2156916f, 0.1019645f, 0.1019645f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.01568734f, 0.03529608f }, { { 0.2588292f, 0.1411809f, 0.1058862f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03529608f, 0.0235309f, 0.03921773f }, { { 0.3764764f, 0.2039268f, 0.1176511f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03137433f, 0.02745257f, 0.03921773f }, { { 0.1960836f, 0.2274563f, 0.3921627f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03529608f, 0.03137433f, 0.04313947f }, { { 0.231378f, 0.2666723f, 0.4509861f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04313947f, 0.03529608f, 0.04706119f }, { { 0.278437f, 0.298045f, 0.4902016f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.03529608f, 0.04313947f }, { { 0.2470644f, 0.3058882f, 0.4627508f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00392195f, 0.00392195f, 0.01176563f }, { { 0.02745257f, 0.04706119f, 0.1254943f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0f, 0.01176563f, 0.01960913f }, { { 0.01960913f, 0.09804292f, 0.2000051f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00784381f, 0.0235309f, 0.03921773f }, { { 0.04706119f, 0.2039268f, 0.4156921f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01568734f, 0.03529608f, 0.04706119f }, { { 0.1019645f, 0.2823587f, 0.4745156f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.03529608f, 0.04313947f }, { { 0.1411809f, 0.3058882f, 0.4353f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.03137433f, 0.04706119f }, { { 0.1607891f, 0.2588292f, 0.4902016f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.03529608f, 0.04706119f }, { { 0.1529458f, 0.2941234f, 0.4902016f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03137433f, 0.04313947f, 0.04706119f }, { { 0.1882403f, 0.352947f, 0.4980448f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0f, 0.00784381f, 0.00784381f }, { { 0.01176563f, 0.07059128f, 0.1058862f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0f, 0.01176563f, 0.00784381f }, { { 0.0f, 0.09412124f, 0.1137294f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0f, 0.01176563f, 0.01568734f }, { { 0.01176563f, 0.1215728f, 0.1725539f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00392195f, 0.01960913f, 0.01568734f }, { { 0.03921773f, 0.1568674f, 0.1921619f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00784381f, 0.0235309f, 0.02745257f }, { { 0.05490454f, 0.1960836f, 0.2745156f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01176563f, 0.03137433f, 0.03137433f }, { { 0.09019956f, 0.2705939f, 0.345104f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.03529608f, 0.02745257f }, { { 0.1411809f, 0.3058882f, 0.3098098f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.03921773f, 0.03529608f }, { { 0.1490242f, 0.3294176f, 0.3764764f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.04313947f, 0.03529608f }, { { 0.1568674f, 0.3568686f, 0.3568686f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0f, 0.01176563f, 0.00784381f }, { { 0.01960913f, 0.1137294f, 0.02745257f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01176563f, 0.0235309f, 0.0f }, { { 0.129416f, 0.1882403f, 0.0f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0f, 0.01960913f, 0.01568734f }, { { 0.00392195f, 0.1803971f, 0.05490454f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.00784381f, 0.02745257f, 0.01960913f }, { { 0.1058862f, 0.2392212f, 0.06274787f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01176563f, 0.03137433f, 0.00392195f }, { { 0.1451026f, 0.2705939f, 0.01176563f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.02745257f, 0.03529608f, 0.0f }, { { 0.2862803f, 0.298045f, 0.00392195f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01568734f, 0.03529608f, 0.0235309f }, { { 0.1921619f, 0.3098098f, 0.07843459f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.02745257f, 0.04313947f, 0.01176563f }, { { 0.3098098f, 0.3490255f, 0.03529608f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.02745257f, 0.04313947f, 0.0235309f }, { { 0.2941234f, 0.345104f, 0.07059128f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03529608f, 0.04706119f, 0.03137433f }, { { 0.3647118f, 0.3764764f, 0.09804292f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.02745257f, 0.02745257f, 0.00784381f }, { { 0.298045f, 0.2274563f, 0.0235309f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03137433f, 0.02745257f, 0.01568734f }, { { 0.3254961f, 0.231378f, 0.05490454f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.03529608f, 0.00784381f }, { { 0.4000058f, 0.298045f, 0.03137433f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.03529608f, 0.0235309f }, { { 0.4000058f, 0.2902018f, 0.07843459f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.03921773f, 0.0235309f }, { { 0.4235353f, 0.3176529f, 0.07451299f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.03921773f, 0.01960913f }, { { 0.4156921f, 0.3372608f, 0.06274787f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.04313947f, 0.0235309f }, { { 0.4156921f, 0.3607903f, 0.07451299f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.04706119f, 0.02745257f }, { { 0.4235353f, 0.3921627f, 0.09019956f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.01176563f, 0.0f }, { { 0.2431428f, 0.1058862f, 0.0f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04313947f, 0.03529608f, 0.0235309f }, { { 0.4509861f, 0.2902018f, 0.07059128f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.04313947f, 0.01176563f }, { { 0.4980448f, 0.352947f, 0.04313947f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.04313947f, 0.0235309f }, { { 0.4902016f, 0.345104f, 0.07451299f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.04313947f, 0.02745257f }, { { 0.4823586f, 0.3647118f, 0.09019956f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.04706119f, 0.02745257f }, { { 0.4902016f, 0.3882412f, 0.09019956f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03137433f, 0.01176563f, 0.00392195f }, { { 0.3254961f, 0.1176511f, 0.01568734f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.02745257f, 0.0f }, { { 0.4980448f, 0.2352996f, 0.00392195f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03921773f, 0.02745257f, 0.01960913f }, { { 0.407849f, 0.2431428f, 0.05882626f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.03137433f, 0.01960913f }, { { 0.4980448f, 0.278437f, 0.05882626f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04706119f, 0.03529608f, 0.02745257f }, { { 0.4980448f, 0.3019665f, 0.08235628f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04313947f, 0.03921773f, 0.03137433f }, { { 0.4470646f, 0.3215744f, 0.1019645f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.01176563f, 0.01176563f, 0.01176563f }, { { 0.07843459f, 0.07843459f, 0.07843459f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.02745257f, 0.02745257f, 0.02745257f }, { { 0.1843188f, 0.1843188f, 0.1843188f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.03529608f, 0.03529608f, 0.03529608f }, { { 0.2235348f, 0.2235348f, 0.2235348f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.04313947f, 0.03921773f, 0.03921773f }, { { 0.2588292f, 0.250986f, 0.2431428f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } },
    { 0.2f, 0.0f, { 0.0235309f, 0.0235309f, 0.0235309f }, { { 0.00392195f, 0.00392195f, 0.00392195f }, 1.0f, 0.0f, 1.3f }, { { 0.0f, 0.0f, 0.0f }, 1.0f, 0.5f } } // line 271

};

// NOTE: WHERE DOES THIS COME FROM? just taken from a render
const rio::BaseVec4f cLightDir = { -0.12279f, 0.70711f, 0.69636f, 1.0f };

const rio::BaseVec4f cLightColor = { 1.00f, 1.00f, 1.00f, 1.00f };

}

Shader::Shader()
#if RIO_IS_CAFE
    : mAttribute()
    , mFetchShader()
#elif RIO_IS_WIN
    : mVBOHandle()
    , mVAOHandle()
#endif
{
    rio::MemUtil::set(mVertexUniformLocation, u8(-1), sizeof(mVertexUniformLocation));
    rio::MemUtil::set(mPixelUniformLocation, u8(-1), sizeof(mPixelUniformLocation));
    mSamplerLocation = -1;
    rio::MemUtil::set(mAttributeLocation, u8(-1), sizeof(mAttributeLocation));
}

Shader::~Shader()
{
#if RIO_IS_CAFE
    if (mFetchShader.program != nullptr)
    {
        rio::MemUtil::free(mFetchShader.program);
        mFetchShader.program = nullptr;
    }
#elif RIO_IS_WIN
    if (mVAOHandle != GL_NONE)
    {
        RIO_GL_CALL(glDeleteVertexArrays(1, &mVAOHandle));
        RIO_GL_CALL(glDeleteBuffers(FFL_ATTRIBUTE_BUFFER_TYPE_MAX, mVBOHandle));
        rio::MemUtil::set(mVBOHandle, 0, sizeof(mVBOHandle));
        mVAOHandle = GL_NONE;
    }
#endif
}

void Shader::initialize()
{
    mShader.load("SampleShader", rio::Shader::MODE_UNIFORM_REGISTER);

    mVertexUniformLocation[VERTEX_UNIFORM_MV]   = mShader.getVertexUniformLocation("mv");
    mVertexUniformLocation[VERTEX_UNIFORM_PROJ] = mShader.getVertexUniformLocation("proj");

    mPixelUniformLocation[PIXEL_UNIFORM_MODULATE_TYPE]                     = mShader.getFragmentUniformLocation("modulateType");
    mPixelUniformLocation[PIXEL_UNIFORM_GAMMA_TYPE]                     = mShader.getFragmentUniformLocation("gammaType");
    mPixelUniformLocation[PIXEL_UNIFORM_DRAW_TYPE]                     = mShader.getFragmentUniformLocation("drawType");
    mPixelUniformLocation[PIXEL_UNIFORM_PAD0]              = mShader.getFragmentUniformLocation("pad0");
    mPixelUniformLocation[PIXEL_UNIFORM_CONST_COLOR1] = mShader.getFragmentUniformLocation("constColor1");
    mPixelUniformLocation[PIXEL_UNIFORM_CONST_COLOR2] = mShader.getFragmentUniformLocation("constColor2");
    mPixelUniformLocation[PIXEL_UNIFORM_CONST_COLOR3] = mShader.getFragmentUniformLocation("constColor3");
    mPixelUniformLocation[PIXEL_UNIFORM_LIGHT_DIR_IN_VIEW]                  = mShader.getFragmentUniformLocation("lightDirInView");
    mPixelUniformLocation[PIXEL_UNIFORM_LIGHT_COLOR]               = mShader.getFragmentUniformLocation("lightColor");
    mPixelUniformLocation[PIXEL_UNIFORM_SSS_COLOR]             = mShader.getFragmentUniformLocation("u_SssColor");
    mPixelUniformLocation[PIXEL_UNIFORM_SPECULAR_COLOR]           = mShader.getFragmentUniformLocation("u_SpecularColor");
    mPixelUniformLocation[PIXEL_UNIFORM_RIM_COLOR]           = mShader.getFragmentUniformLocation("u_RimColor");
    mPixelUniformLocation[PIXEL_UNIFORM_HALF_LAMBERT_FACTOR]          = mShader.getFragmentUniformLocation("u_HalfLambertFactor");
    mPixelUniformLocation[PIXEL_UNIFORM_SSS_SPECULAR_FACTOR]     = mShader.getFragmentUniformLocation("u_SssSpecularFactor");
    mPixelUniformLocation[PIXEL_UNIFORM_SPECULAR_FACTOR_A]    = mShader.getFragmentUniformLocation("u_SpecularFactorA");
    mPixelUniformLocation[PIXEL_UNIFORM_SPECULAR_FACTOR_B]    = mShader.getFragmentUniformLocation("u_SpecularFactorB");
    mPixelUniformLocation[PIXEL_UNIFORM_SPECULAR_SHINNESS]                       = mShader.getFragmentUniformLocation("u_SpecularShinness");
    mPixelUniformLocation[PIXEL_UNIFORM_RIM_POWER]                  = mShader.getFragmentUniformLocation("u_RimPower");
    mPixelUniformLocation[PIXEL_UNIFORM_RIM_WIDTH]                  = mShader.getFragmentUniformLocation("u_RimWidth");
    mPixelUniformLocation[PIXEL_UNIFORM_LIGHT_ENABLE]                  = mShader.getFragmentUniformLocation("lightEnable");

    mSamplerLocation = mShader.getFragmentSamplerLocation("s_Tex");

    mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_POSITION]  = mShader.getVertexAttribLocation("i_Position");
    mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_NORMAL]    = mShader.getVertexAttribLocation("i_Normal");
    //mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_TANGENT]   = mShader.getVertexAttribLocation("a_tangent");
    mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_TEXCOORD]  = mShader.getVertexAttribLocation("i_TexCoord");
    // TODO TODO I DO NOT KNOW WHAT TO DO WITH PARAMETER SO THIS MAKES IT EFFECTIVELY RANDOMY
    // NOTE: VALUES FOR JASMINE, IN CASE IT IS NEEDED: -0.00787f, 0.40157f, 0.03937f, -1.0f
    mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_COLOR]     = mShader.getVertexAttribLocation("i_Parameter");

#if RIO_IS_CAFE
    GX2InitAttribStream(
        &(mAttribute[FFL_ATTRIBUTE_BUFFER_TYPE_POSITION]),
        mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_POSITION],
        FFL_ATTRIBUTE_BUFFER_TYPE_POSITION,
        0,
        GX2_ATTRIB_FORMAT_FLOAT_32_32_32
    );
    GX2InitAttribStream(
        &(mAttribute[FFL_ATTRIBUTE_BUFFER_TYPE_TEXCOORD]),
        mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_TEXCOORD],
        FFL_ATTRIBUTE_BUFFER_TYPE_TEXCOORD,
        0,
        GX2_ATTRIB_FORMAT_FLOAT_32_32
    );
    GX2InitAttribStream(
        &(mAttribute[FFL_ATTRIBUTE_BUFFER_TYPE_NORMAL]),
        mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_NORMAL],
        FFL_ATTRIBUTE_BUFFER_TYPE_NORMAL,
        0,
        GX2_ATTRIB_FORMAT_SNORM_10_10_10_2
    );
    /*GX2InitAttribStream(
        &(mAttribute[FFL_ATTRIBUTE_BUFFER_TYPE_TANGENT]),
        mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_TANGENT],
        FFL_ATTRIBUTE_BUFFER_TYPE_TANGENT,
        0,
        GX2_ATTRIB_FORMAT_SNORM_8_8_8_8
    );*/
    GX2InitAttribStream(
        &(mAttribute[FFL_ATTRIBUTE_BUFFER_TYPE_COLOR]),
        mAttributeLocation[FFL_ATTRIBUTE_BUFFER_TYPE_COLOR],
        FFL_ATTRIBUTE_BUFFER_TYPE_COLOR,
        0,
        GX2_ATTRIB_FORMAT_UNORM_8_8_8_8
    );

    u32 size = GX2CalcFetchShaderSizeEx(FFL_ATTRIBUTE_BUFFER_TYPE_MAX, GX2_FETCH_SHADER_TESSELLATION_NONE, GX2_TESSELLATION_MODE_DISCRETE);
    void* buffer = rio::MemUtil::alloc(size, GX2_SHADER_ALIGNMENT);
    GX2InitFetchShaderEx(&mFetchShader, (u8*)buffer, FFL_ATTRIBUTE_BUFFER_TYPE_MAX, mAttribute, GX2_FETCH_SHADER_TESSELLATION_NONE, GX2_TESSELLATION_MODE_DISCRETE);
#elif RIO_IS_WIN
    RIO_ASSERT(mVAOHandle == GL_NONE);
    RIO_GL_CALL(glGenBuffers(FFL_ATTRIBUTE_BUFFER_TYPE_MAX, mVBOHandle));
    RIO_GL_CALL(glGenVertexArrays(1, &mVAOHandle));
    RIO_ASSERT(mVAOHandle != GL_NONE);
#endif

    mSampler.setWrap(rio::TEX_WRAP_MODE_MIRROR, rio::TEX_WRAP_MODE_MIRROR, rio::TEX_WRAP_MODE_MIRROR);

    mCallback.pObj = this;
    mCallback.pApplyAlphaTestFunc = &Shader::applyAlphaTestCallback_;
    mCallback.pDrawFunc = &Shader::drawCallback_;
    mCallback.pSetMatrixFunc = &Shader::setMatrixCallback_;
    FFLSetShaderCallback(&mCallback);
    // HACK: have to set this AFTER FFLSetShaderCallback (initializes it to false)
    // this sets the faceline color alpha to 0, which is needed by this shader
    mCallback.facelineColorIsTransparent = true;
}

void Shader::bind(bool light_enable, FFLiCharInfo* pCharInfo)
{
    mpCharInfo = pCharInfo;
    mShader.bind();
#if RIO_IS_CAFE
    GX2SetFetchShader(&mFetchShader);
#elif RIO_IS_WIN
    RIO_GL_CALL(glBindVertexArray(mVAOHandle));
    for (u32 i = 0; i < FFL_ATTRIBUTE_BUFFER_TYPE_MAX; i++)
        RIO_GL_CALL(glDisableVertexAttribArray(i));
#endif

    // NOTE: no light enable means drawing mask or faceline textures
    mShader.setUniform(light_enable, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_LIGHT_ENABLE]);

    //mShader.setUniform(s32(0), u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_PAD0]);
    mShader.setUniform(sGammaType, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_GAMMA_TYPE]);
    mShader.setUniform(cLightDir, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_LIGHT_DIR_IN_VIEW]);
    mShader.setUniform(cLightColor, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_LIGHT_COLOR]);

}

void Shader::setViewUniform(const rio::BaseMtx34f& model_mtx, const rio::BaseMtx34f& view_mtx, const rio::BaseMtx44f& proj_mtx) const
{
    mShader.setUniform(proj_mtx, mVertexUniformLocation[VERTEX_UNIFORM_PROJ], u32(-1));

    rio::Matrix34f mv;
    mv.setMul(static_cast<const rio::Matrix34f&>(view_mtx), static_cast<const rio::Matrix34f&>(model_mtx));
    rio::Matrix44f mv44;
    mv44.fromMatrix34(mv);
    mShader.setUniform(mv44, mVertexUniformLocation[VERTEX_UNIFORM_MV], u32(-1));
}

void Shader::applyAlphaTest(bool enable, rio::Graphics::CompareFunc func, f32 ref) const
{
#if RIO_IS_CAFE
    GX2SetAlphaTest(enable, GX2CompareFunction(func), ref);
#endif
}

void Shader::setCulling(FFLCullMode mode)
{
    if (mode > FFL_CULL_MODE_FRONT)
        return;

    rio::RenderState render_state;

    switch (mode)
    {
    case FFL_CULL_MODE_NONE:
        render_state.setCullingMode(rio::Graphics::CULLING_MODE_NONE);
        break;
    case FFL_CULL_MODE_BACK:
        render_state.setCullingMode(rio::Graphics::CULLING_MODE_BACK);
        break;
    case FFL_CULL_MODE_FRONT:
        render_state.setCullingMode(rio::Graphics::CULLING_MODE_FRONT);
        break;
    default:
        break;
    }

    render_state.applyCullingAndPolygonModeAndPolygonOffset();
}

void Shader::applyAlphaTestCallback_(void* p_obj, bool enable, rio::Graphics::CompareFunc func, f32 ref)
{
    static_cast<Shader*>(p_obj)->applyAlphaTest(enable, func, ref);
}

void Shader::bindTexture_(const FFLModulateParam& modulateParam)
{
    if (modulateParam.pTexture2D != nullptr)
    {
        mSampler.linkTexture2D(modulateParam.pTexture2D);
        mSampler.tryBindFS(mSamplerLocation, 0);
    }
}

void Shader::setConstColor_(u32 ps_loc, const FFLColor& color)
{
    mShader.setUniform(getColorUniform(color), u32(-1), ps_loc);
}

void Shader::setModulateMode_(FFLModulateMode mode)
{
    // GLASS AND CAP MODULATE TYPES ARE REVERSED ON SWITCH SHADER
    if (mode == FFL_MODULATE_MODE_4) mode = FFL_MODULATE_MODE_5;
    else if (mode == FFL_MODULATE_MODE_5) mode = FFL_MODULATE_MODE_4;
    mShader.setUniform(s32(mode), u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_MODULATE_TYPE]);
}

void Shader::setModulate_(const FFLModulateParam& modulateParam)
{
    setModulateMode_(modulateParam.mode);

    // if you want to change colors based on modulateParam.type
    // FFL_MODULATE_TYPE_SHAPE_HAIR
    // hair color: pColorR/const1
    // FFL_MODULATE_TYPE_EYEBROW
    // eyebrow color: pColorB/const2
    // NOTE, also need to color: FFL_MODULATE_TYPE_SHAPE_BEARD, FFL_MODULATE_TYPE_MUSTACHE, FFL_MODULATE_TYPE_FACE_BEARD

    switch (modulateParam.mode)
    {
    case FFL_MODULATE_MODE_0:
    case FFL_MODULATE_MODE_3:
    case FFL_MODULATE_MODE_4:
    case FFL_MODULATE_MODE_5:
        setConstColor_(mPixelUniformLocation[PIXEL_UNIFORM_CONST_COLOR1], *modulateParam.pColorR);
        break;
    case FFL_MODULATE_MODE_2:
        setConstColor_(mPixelUniformLocation[PIXEL_UNIFORM_CONST_COLOR1], *modulateParam.pColorR);
        setConstColor_(mPixelUniformLocation[PIXEL_UNIFORM_CONST_COLOR2], *modulateParam.pColorG);
        mShader.setUniform(modulateParam.pColorB->r, modulateParam.pColorB->g, modulateParam.pColorB->b, 0.0f, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_CONST_COLOR3]);
        //setConstColor_(mPixelUniformLocation[PIXEL_UNIFORM_CONST_COLOR3], *modulateParam.pColorB);
        break;
    default:
        break;
    }

    bindTexture_(modulateParam);
}

void Shader::setMaterial_(const FFLModulateType modulateType)
{
    // we need to get favorite/faceline/hair/beard color from somewhere so
    //FFLiCharInfo* mpCharInfo = &reinterpret_cast<FFLiCharModel*>(mpCharModel)->charInfo;

    //RIO_LOG("[Shader::setMaterial_] your mii's favorite color id is: %d\n", charModel->mpCharInfo->favoriteColor);

    DrawParamMaterial drawParamMaterial;
    int commonColor;
    switch (modulateType) {
        case FFL_MODULATE_TYPE_SHAPE_NOSELINE:
        case FFL_MODULATE_TYPE_SHAPE_MASK:
            drawParamMaterial = cMaskMaterial;
            break;
        case FFL_MODULATE_TYPE_SHAPE_GLASS:
            drawParamMaterial = cGlassMaterial;
            break;
        // pants: special or not
        case FFL_MODULATE_TYPE_SHAPE_FOREHEAD:
        case FFL_MODULATE_TYPE_SHAPE_FACELINE:
            // does not need conversion
            drawParamMaterial = cFacelineMaterials[mpCharInfo->parts.facelineColor];
            break;
        case FFL_MODULATE_TYPE_SHAPE_NOSE:
            drawParamMaterial = cNoseMaterials[mpCharInfo->parts.facelineColor];
            break;
        // body: favorite color
        // TODO: TODO: ADD THIS AS A REAL CONSTANT
        case 20:
            drawParamMaterial = cBodyMaterials[mpCharInfo->favoriteColor];
            break;
        case FFL_MODULATE_TYPE_SHAPE_CAP:
            drawParamMaterial = cHatMaterials[mpCharInfo->favoriteColor];
            break;

        case FFL_MODULATE_TYPE_SHAPE_HAIR:
            // HACK: ver3 hair color 0 maps to common color 8
            if (!isCommonColorMarked(mpCharInfo->parts.hairColor) && mpCharInfo->parts.hairColor == 0)
                commonColor = 8;
            else
                commonColor = unmarkCommonColor(mpCharInfo->parts.hairColor);
            drawParamMaterial = cHairMaterials[commonColor];
            //RIO_LOG("hair color: %d, specular factor B: %f\n", commonColor, drawParamMaterial.specular.factorB);
            break;
        case FFL_MODULATE_TYPE_SHAPE_BEARD:
            // HACK: same as above
            if (!isCommonColorMarked(mpCharInfo->parts.beardColor) && mpCharInfo->parts.beardColor == 0)
                commonColor = 8;
            else
                commonColor = unmarkCommonColor(mpCharInfo->parts.beardColor);
            drawParamMaterial = cBeardMaterials[commonColor];
            break;
        default:
            // not suitable for material, return
            return;
    }


    mShader.setUniform(drawParamMaterial.sssColor.r, drawParamMaterial.sssColor.g, drawParamMaterial.sssColor.b, 1.00f, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_SSS_COLOR]);

    mShader.setUniform(drawParamMaterial.specular.color.r, drawParamMaterial.specular.color.g, drawParamMaterial.specular.color.b, 1.00f, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_SPECULAR_COLOR]);

    mShader.setUniform(drawParamMaterial.rimLight.color.r, drawParamMaterial.rimLight.color.g, drawParamMaterial.rimLight.color.b, 1.00f, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_RIM_COLOR]);

    mShader.setUniform(drawParamMaterial.halfLambertFactor, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_HALF_LAMBERT_FACTOR]);

    mShader.setUniform(drawParamMaterial.sssSpecularBlendFactor, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_SSS_SPECULAR_FACTOR]);

    mShader.setUniform(drawParamMaterial.specular.factorA, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_SPECULAR_FACTOR_A]);
    mShader.setUniform(drawParamMaterial.specular.factorB, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_SPECULAR_FACTOR_B]);
    mShader.setUniform(drawParamMaterial.specular.shinness, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_SPECULAR_SHINNESS]);

    mShader.setUniform(drawParamMaterial.rimLight.power, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_RIM_POWER]);

    mShader.setUniform(drawParamMaterial.rimLight.width, u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_RIM_WIDTH]);


    // set draw type here
    #define DRAW_TYPE_NORMAL   0
    #define DRAW_TYPE_FACELINE 1
    #define DRAW_TYPE_HAIR     2
    int drawType;

    switch (modulateType) {
        case FFL_MODULATE_TYPE_SHAPE_FACELINE:
            drawType = DRAW_TYPE_FACELINE;
            break;
        case FFL_MODULATE_TYPE_SHAPE_HAIR:
            drawType = DRAW_TYPE_HAIR;
            break;
        default:
            drawType = DRAW_TYPE_NORMAL;
            break;
    }
    mShader.setUniform(s32(drawType), u32(-1), mPixelUniformLocation[PIXEL_UNIFORM_DRAW_TYPE]);
}

void Shader::draw_(const FFLDrawParam& draw_param)
{
    setCulling(draw_param.cullMode);
    setModulate_(draw_param.modulateParam);
    setMaterial_(draw_param.modulateParam.type);

    // HACK: INJECT SWITCH GLASS NORMALS
    // the switch shader does a reflection on the glasses
    // however neither the FFLResHigh or AFLResHigh resources
    // have normals on the glass mesh so this is the easiest
    // way to hack it in
    static const u32 cGlassNormalBufferLE[] = {
        0x567a67ca, 0x567a6436, 0x56759fca, 0x56759c36
    };

    if (draw_param.primitiveParam.pIndexBuffer != nullptr)
    {
#if RIO_IS_CAFE
        for (int type = FFL_ATTRIBUTE_BUFFER_TYPE_POSITION; type <= FFL_ATTRIBUTE_BUFFER_TYPE_COLOR; ++type)
        {
            GX2SetAttribBuffer(
                type,
                draw_param.attributeBufferParam.attributeBuffers[type].size,
                draw_param.attributeBufferParam.attributeBuffers[type].stride,
                draw_param.attributeBufferParam.attributeBuffers[type].ptr
            );
        }
#elif RIO_IS_WIN
        for (int type = FFL_ATTRIBUTE_BUFFER_TYPE_POSITION; type <= FFL_ATTRIBUTE_BUFFER_TYPE_COLOR; ++type)
        {
            const FFLAttributeBuffer& buffer = draw_param.attributeBufferParam.attributeBuffers[type];
            s32 location = mAttributeLocation[type];
            void* ptr = buffer.ptr;

            if (ptr && location != -1)
            {
                u32 stride = buffer.stride;
                u32 vbo_handle = mVBOHandle[type];
                u32 size = buffer.size;

                if (stride == 0)
                {
                    // Directly set vertex attribute without buffer
                    switch (type)
                    {
                    case FFL_ATTRIBUTE_BUFFER_TYPE_POSITION:
                        RIO_GL_CALL(glVertexAttrib3fv(location, static_cast<f32*>(ptr)));
                        break;
                    case FFL_ATTRIBUTE_BUFFER_TYPE_TEXCOORD:
                        RIO_GL_CALL(glVertexAttrib2fv(location, static_cast<f32*>(ptr)));
                        break;
                    case FFL_ATTRIBUTE_BUFFER_TYPE_NORMAL:
                        RIO_GL_CALL(glVertexAttribP4ui(location, GL_INT_2_10_10_10_REV, true, *static_cast<u32*>(ptr)));
                        break;
                    /*case FFL_ATTRIBUTE_BUFFER_TYPE_TANGENT:
                        RIO_GL_CALL(glVertexAttrib4Nbv(location, static_cast<s8*>(ptr)));
                        break;
                    */case FFL_ATTRIBUTE_BUFFER_TYPE_COLOR:
                        RIO_GL_CALL(glVertexAttrib4Nubv(location, static_cast<u8*>(ptr)));
                        break;
                    default:
                        break;
                    }
                }
                else
                {
                    // Bind buffer and set vertex attribute pointer
                    RIO_GL_CALL(glBindBuffer(GL_ARRAY_BUFFER, vbo_handle));
                    RIO_GL_CALL(glBufferData(GL_ARRAY_BUFFER, size, ptr, GL_STATIC_DRAW));
                    RIO_GL_CALL(glEnableVertexAttribArray(location));

                    // Determine attribute pointer parameters based on buffer type
                    switch (type)
                    {
                    case FFL_ATTRIBUTE_BUFFER_TYPE_POSITION:
                        RIO_GL_CALL(glVertexAttribPointer(location, 3, GL_FLOAT, false, stride, nullptr));
                        break;
                    case FFL_ATTRIBUTE_BUFFER_TYPE_TEXCOORD:
                        #ifdef RIO_NO_CLIP_CONTROL
                        // accomodate OpenGL default clip plane by flipping texCoords
                        // NOTE: results in flipping face texture, RATHER THAN...
                        // ... leaving it upside down, and flipping it SOMEWHERE else (not in shader or here...???)
                        // NOTE: CAN ALSO PROBABLY BE ADDED TO FFL ITSELF, I just don't know where to put it
                        if (draw_param.modulateParam.type == FFL_MODULATE_TYPE_SHAPE_MASK ||
                            draw_param.modulateParam.type == FFL_MODULATE_TYPE_FACE_MAKE ||
                            draw_param.modulateParam.type == FFL_MODULATE_TYPE_FACE_LINE ||
                            draw_param.modulateParam.type == FFL_MODULATE_TYPE_FACE_BEARD)
                        {
                            // Flip the texture coordinates within the buffer
                            u32 numTexCoords = size / sizeof(f32);

                            f32* flippedTexCoords = new f32[numTexCoords];

                            for (u32 i = 0; i < numTexCoords; i += 2)
                            {
                                f32* originalTexCoord = static_cast<f32*>(ptr) + i;
                                flippedTexCoords[i] = originalTexCoord[0];
                                // flip Y coordinate
                                flippedTexCoords[i + 1] = 1.0f - originalTexCoord[1];
                            }

                            RIO_GL_CALL(glBufferData(GL_ARRAY_BUFFER, size, flippedTexCoords, GL_STATIC_DRAW));

                            // Don't forget to free the allocated memory
                            delete[] flippedTexCoords;

                        }
                        else
                        {
                            RIO_GL_CALL(glBufferData(GL_ARRAY_BUFFER, size, ptr, GL_STATIC_DRAW));
                        }
                        #else
                        RIO_GL_CALL(glBufferData(GL_ARRAY_BUFFER, size, ptr, GL_STATIC_DRAW));
                        #endif
                        RIO_GL_CALL(glVertexAttribPointer(location, 2, GL_FLOAT, false, stride, nullptr));
                        break;
                    case FFL_ATTRIBUTE_BUFFER_TYPE_NORMAL:
                        // force this arbitrary normal buffer when glass mesh is being drawn
                        if (draw_param.modulateParam.type == FFL_MODULATE_TYPE_SHAPE_GLASS)
                            RIO_GL_CALL(glBufferData(GL_ARRAY_BUFFER, sizeof(cGlassNormalBufferLE), cGlassNormalBufferLE, GL_STATIC_DRAW));
                        RIO_GL_CALL(glVertexAttribPointer(location, 4, GL_INT_2_10_10_10_REV, true, stride, nullptr));
                        break;
                    /*case FFL_ATTRIBUTE_BUFFER_TYPE_TANGENT:
                        RIO_GL_CALL(glVertexAttribPointer(location, 4, GL_BYTE, true, stride, nullptr));
                        break;
                    */case FFL_ATTRIBUTE_BUFFER_TYPE_COLOR:
                        RIO_GL_CALL(glVertexAttribPointer(location, 4, GL_UNSIGNED_BYTE, true, stride, nullptr));
                        break;
                    default:
                        break;
                    }
                }
            }
        }
#endif
        // Draw elements
        rio::Drawer::DrawElements(
            draw_param.primitiveParam.primitiveType,
            draw_param.primitiveParam.indexCount,
            (const u16*)draw_param.primitiveParam.pIndexBuffer
        );
    }
}


void Shader::drawCallback_(void* p_obj, const FFLDrawParam& draw_param)
{
    static_cast<Shader*>(p_obj)->draw_(draw_param);
}

void Shader::setMatrix_(const rio::BaseMtx44f& matrix)
{
    mShader.setUniform(matrix, mVertexUniformLocation[VERTEX_UNIFORM_PROJ], u32(-1));
    mShader.setUniformColumnMajor(rio::Matrix44f::ident, mVertexUniformLocation[VERTEX_UNIFORM_MV], u32(-1));
}

void Shader::setMatrixCallback_(void* p_obj, const rio::BaseMtx44f& matrix)
{
    static_cast<Shader*>(p_obj)->setMatrix_(matrix);
}
